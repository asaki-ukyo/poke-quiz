<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>poke-quiz</title>
  <style>
    :root {
      --bg: #0b1020; --fg: #e8eef8; --muted: #9fb0c8; --accent: #52a5ff;
      --ok:#28c76f; --ng:#ff4d4f; --card:#151b2f; --border:#24314f;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",Meiryo,"Noto Sans JP",sans-serif;color:var(--fg);background: radial-gradient(1200px 800px at 20% -10%, #112049 0%, #0b1020 60%)}
    a{color:var(--accent)}
    .wrap{max-width:960px;margin:0 auto;padding:24px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px;font-size:28px;letter-spacing:.02em}
    p{color:var(--muted)}
    .screen{display:none;gap:16px}
    .screen.active{display:grid}
    .hero{display:grid;gap:8px;justify-items:center}
    .hero img{width:min(570px, 100%);max-width:100%;height:auto;aspect-ratio:1/1;object-fit:contain;border-radius:12px;background:#0e1530;border:1px solid var(--border)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .grow{flex:1 1 auto;min-width:0}
    input[type=text]{width:100%;padding:14px 16px;border-radius:12px;border:1px solid var(--border);background:#0e1530;color:var(--fg);font-size:18px;outline:none}
    input::placeholder{color:#7282a2}
    button{appearance:none;border:1px solid transparent;background:var(--accent);color:#fff;padding:12px 18px;border-radius:12px;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 4px 14px rgba(82,165,255,.35)}
    button.ghost{background:transparent;color:var(--fg);border-color:var(--border);box-shadow:none}
    button:disabled{opacity:.5;cursor:not-allowed}
    .note{font-size:14px;color:var(--muted)}
    ul.note{margin:8px 0 0 20px; padding-left:1em}
    .note .sub{display:block;opacity:.85;font-size:.95em;margin-top:2px;margin-left:1.3em;padding-left:0}
    .meta{color:var(--muted);font-size:14px}
    .badge{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;background:#101735}
    table{width:100%;border-collapse:collapse;border-spacing:0}
    thead th{text-align:left;color:var(--muted);font-weight:600;padding:10px;border-bottom:1px solid var(--border)}
    tbody td{padding:10px;border-bottom:1px solid var(--border);vertical-align:middle}
    td.center{text-align:center;width:64px}
    .ok{color:var(--ok);font-weight:900}
    .ng{color:var(--ng);font-weight:900}
    .thumb{width:96px;height:96px;object-fit:contain;background:#0e1530;border-radius:8px;border:1px solid var(--border)}
    .footer-actions{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:16px}
    #error{display:none;color:#ffb4b4}
  
.muted-link{color:var(--muted); text-decoration:underline; display:inline-block; margin-top:6px}
.muted-link:hover{color:var(--fg)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>poke-quiz</h1>

      <!-- Start Screen -->
      <div id="start-screen" class="screen active">
        <p class="meta">ãƒã‚±ãƒ¢ãƒ³ãšã‹ã‚“ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã« 30 å•å‡ºé¡Œã€‚<span class="badge" id="poolInfo">èª­ã¿è¾¼ã¿ä¸­â€¦</span></p>
        <div id="error" class="note"></div>
        <div class="hero">
          <button id="playBtn" style="width:max(200px, 30%)" disabled>â–¶ ãƒ—ãƒ¬ã‚¤é–‹å§‹</button>
          <a id="openAnswers" href="#" class="muted-link" style="font-size:14px">ğŸ“– æ­£ç­”ä¸€è¦§ï¼ˆåˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰</a>
          <div class="note">
  <strong>æ³¨æ„äº‹é …</strong>
  <ul class="note">
    <li>ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã¯ã€Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³åï¼‹ãƒã‚±ãƒ¢ãƒ³åã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ä¾‹ï¼‰ã‚¢ãƒ­ãƒ¼ãƒ©ã‚³ãƒ©ãƒƒã‚¿</div></li>
    <li>ã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹ã®ã™ãŒãŸã¯ã€Œãƒã‚±ãƒ¢ãƒ³åï¼‹ã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹ã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ä¾‹ï¼‰ãƒ•ã‚·ã‚®ãƒãƒŠã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹</div></li>
    <li>é›Œé›„ã§å§¿ãŒç•°ãªã‚‹ãƒã‚±ãƒ¢ãƒ³ã¯ã€Œãƒã‚±ãƒ¢ãƒ³åï¼‹ã‚ªã‚¹orãƒ¡ã‚¹ã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ä¾‹ï¼‰ã‚±ãƒ³ãƒ›ãƒ­ã‚¦ã‚ªã‚¹</div><div class="sub">ãªãŠwebã®ã€Œãƒã‚±ãƒ¢ãƒ³ãšã‹ã‚“ã€æº–æ‹ ã§ã™ã€‚</div><div class="sub">ã‚«ãƒãƒ«ãƒ‰ãƒ³ãªã©ã‚²ãƒ¼ãƒ ä¸­ã§ã¯é›Œé›„ã®å·®ãŒã‚ã‚‹å ´åˆã§ã‚‚ã€</div><div class="sub">ãƒã‚±ãƒ¢ãƒ³ãšã‹ã‚“ä¸Šã§å·®ãŒãªã‘ã‚Œã°ã‚ªã‚¹ãƒ¡ã‚¹ã®è¨˜è¼‰ã¯ä¸è¦ã§ã™ã€‚</div></li>
    <li>è¤‡æ•°å½¢æ…‹ã‚’æŒã¤ãƒã‚±ãƒ¢ãƒ³ã¯ã€Œãƒã‚±ãƒ¢ãƒ³åï¼‹å½¢æ…‹åã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ãŸã ã—ä½•ã‹é•ã†å ´åˆã‚‚ã‚ã‚‹ã®ã§ã„ã„æ„Ÿã˜ã«ã‚„ã£ã¦ãã ã•ã„ã€‚</div></li>
    <li>ãƒ¤ãƒãƒãƒ£ã€ãƒãƒƒãƒˆãƒ‡ã‚¹ã€ãƒãƒ£ãƒ‡ã‚¹ãŠã‚ˆã³ãƒ¤ãƒã‚½ãƒãƒ£ã®çœŸè´‹ã¯é™¤å¤–ã—ã¦ã‚ã‚Šã¾ã™ã€‚<div class="sub">ã“ã‚Œã‚‰ã¯ãƒã‚±ãƒ¢ãƒ³åã®ã¿è§£ç­”ã—ã¦ãã ã•ã„ã€‚</div></li>
  </ul>
</div>
        </div>
      </div>

      <!-- Game Screen -->
      <div id="game-screen" class="screen">
        <div class="row" style="justify-content: space-between">
          <div class="meta">å•é¡Œ <span id="qNow">1</span> / <span id="qMax">30</span></div>
          <div class="meta">é€£ç¶šæ­£è§£: <span id="streak">0</span></div>
        </div>
        <div class="hero" style="margin-top:4px;">
          <img id="questionImage" alt="å•é¡Œç”»åƒ" src="" />
          <form id="answerForm" class="row" autocomplete="off">
            <input id="answerInput" class="grow" type="text" placeholder="ã“ã“ã«åå‰ã‚’å…¥åŠ›" />
            <button id="submitBtn" type="submit">è§£ç­”ã™ã‚‹</button>
            <button id="giveUpBtn" type="button">è«¦ã‚ã‚‹</button>
          </form>
          <div class="note">
  <strong>æ³¨æ„äº‹é …</strong>
  <ul class="note">
    <li>ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã¯ã€Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³åï¼‹ãƒã‚±ãƒ¢ãƒ³åã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ä¾‹ï¼‰ã‚¢ãƒ­ãƒ¼ãƒ©ã‚³ãƒ©ãƒƒã‚¿</div></li>
    <li>ã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹ã®ã™ãŒãŸã¯ã€Œãƒã‚±ãƒ¢ãƒ³åï¼‹ã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹ã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ä¾‹ï¼‰ãƒ•ã‚·ã‚®ãƒãƒŠã‚­ãƒ§ãƒ€ã‚¤ãƒãƒƒã‚¯ã‚¹</div></li>
    <li>é›Œé›„ã§å§¿ãŒç•°ãªã‚‹ãƒã‚±ãƒ¢ãƒ³ã¯ã€Œãƒã‚±ãƒ¢ãƒ³åï¼‹ã‚ªã‚¹orãƒ¡ã‚¹ã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ä¾‹ï¼‰ã‚±ãƒ³ãƒ›ãƒ­ã‚¦ã‚ªã‚¹</div><div class="sub">ãªãŠwebã®ã€Œãƒã‚±ãƒ¢ãƒ³ãšã‹ã‚“ã€æº–æ‹ ã§ã™ã€‚</div><div class="sub">ã‚«ãƒãƒ«ãƒ‰ãƒ³ãªã©ã‚²ãƒ¼ãƒ ä¸­ã§ã¯é›Œé›„ã®å·®ãŒã‚ã‚‹å ´åˆã§ã‚‚ã€</div><div class="sub">ãƒã‚±ãƒ¢ãƒ³ãšã‹ã‚“ä¸Šã§å·®ãŒãªã‘ã‚Œã°ã‚ªã‚¹ãƒ¡ã‚¹ã®è¨˜è¼‰ã¯ä¸è¦ã§ã™ã€‚</div></li>
    <li>è¤‡æ•°å½¢æ…‹ã‚’æŒã¤ãƒã‚±ãƒ¢ãƒ³ã¯ã€Œãƒã‚±ãƒ¢ãƒ³åï¼‹å½¢æ…‹åã€ã§è§£ç­”ã—ã¦ãã ã•ã„ã€‚<div class="sub">ãŸã ã—ä½•ã‹é•ã†å ´åˆã‚‚ã‚ã‚‹ã®ã§ã„ã„æ„Ÿã˜ã«ã‚„ã£ã¦ãã ã•ã„ã€‚</div></li>
    <li>ãƒ¤ãƒãƒãƒ£ã€ãƒãƒƒãƒˆãƒ‡ã‚¹ã€ãƒãƒ£ãƒ‡ã‚¹ãŠã‚ˆã³ãƒ¤ãƒã‚½ãƒãƒ£ã®çœŸè´‹ã¯é™¤å¤–ã—ã¦ã‚ã‚Šã¾ã™ã€‚<div class="sub">ã“ã‚Œã‚‰ã¯ãƒã‚±ãƒ¢ãƒ³åã®ã¿è§£ç­”ã—ã¦ãã ã•ã„ã€‚</div></li>
  </ul>
</div>
        </div>
      </div>

      <!-- Result Screen -->
      <div id="result-screen" class="screen">
        <div class="row" style="justify-content: space-between">
          <h2 style="margin:0">çµæœ</h2>
          <div class="meta">æ­£è§£æ•°: <strong id="score">0</strong> / <span id="scoreMax">30</span></div>
        </div>
        <div style="overflow:auto; margin-top:8px;">
          <table>
            <thead>
              <tr>
                <th class="center">åˆ¤å®š</th>
                <th>ç”»åƒ</th>
                <th>æ­£ç­”</th>
                <th>è§£ç­”</th>
              </tr>
            </thead>
            <tbody id="resultBody"></tbody>
          </table>
        </div>
        <div class="footer-actions">
          <button id="retryBtn">â†» ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
          <span class="meta">ãƒ’ãƒ³ãƒˆ: <span class="badge">Enter ã§é€ä¿¡</span> / <span class="badge">çµæœã¯ã“ã®å ´ã®ã¿ä¿æŒ</span></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STATE = {
      allImages: [],
      questions: [],
      idx: 0,
      streak: 0,
      records: [],
      goal: 30,
    };

    const els = {
      start: document.getElementById('start-screen'),
      game: document.getElementById('game-screen'),
      result: document.getElementById('result-screen'),
      poolInfo: document.getElementById('poolInfo'),
      error: document.getElementById('error'),
      playBtn: document.getElementById('playBtn'),
      retryBtn: document.getElementById('retryBtn'),
      giveUpBtn: document.getElementById('giveUpBtn'),
      qNow: document.getElementById('qNow'), qMax: document.getElementById('qMax'),
      streak: document.getElementById('streak'),
      img: document.getElementById('questionImage'),
      form: document.getElementById('answerForm'), input: document.getElementById('answerInput'),
      score: document.getElementById('score'), scoreMax: document.getElementById('scoreMax'),
      tbody: document.getElementById('resultBody'),
    };
      (function(){ const link=document.getElementById("openAnswers"); if(link) link.addEventListener("click", openAnswerList); })();


    function showScreen(which){
      els.start.classList.remove('active');
      els.game.classList.remove('active');
      els.result.classList.remove('active');
      if(which==='start') els.start.classList.add('active');
      if(which==='game') els.game.classList.add('active');
      if(which==='result') els.result.classList.add('active');
    }

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }

    function extractAnswerFromFilename(filename){
      const base = filename.split('/').pop();
      const us = base.indexOf('_');
      const dot = base.lastIndexOf('.');
      if(us===-1||dot===-1||dot<=us+1) return '';
      return base.substring(us+1,dot);
    }

    function normalizeName(s){
      if(!s) return '';
      let t = s.normalize('NFKC');
      // ç©ºç™½ï¼ˆåŠè§’/å…¨è§’ï¼‰ã‚’é™¤å»
      t = t.replace(/[\u0020\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g,'');
      // ã‚³ãƒ­ãƒ³é¡ä¼¼ â†’ ":"
      t = t.replace(/[\u003A\uFF1A]/g,':');
      // ä¸­é»’é¡ä¼¼ â†’ ã€Œãƒ»ã€
      t = t.replace(/[\u30FB\uFF65\u00B7\u2022]/g,'ãƒ»');
      // è‹±å­—ã‚’å¤§æ–‡å­—åŒ–
      t = t.toUpperCase();
      return t;
    }

    function prepareQuestions(){
      const pool = shuffle(STATE.allImages.slice());
      const goal = Math.min(STATE.goal, pool.length);
      STATE.questions = pool.slice(0, goal);
      els.qMax.textContent = String(goal);
      els.scoreMax.textContent = String(goal);
      els.poolInfo.textContent = `èª­ã¿è¾¼ã¿å®Œäº†ï¼š${STATE.allImages.length} æš`;
    }

    function renderQuestion(){
      const fn = STATE.questions[STATE.idx];
      els.img.src = `images/${encodeURIComponent(fn)}`;
      els.img.alt = `å•é¡Œç”»åƒ ${STATE.idx+1}`;
      els.qNow.textContent = String(STATE.idx+1);
      els.streak.textContent = String(STATE.streak);
      els.input.value='';
      setTimeout(()=>els.input.focus(),0);
    }

    function startGame(){
      STATE.idx=0; STATE.streak=0; STATE.records=[];
      prepareQuestions();
      showScreen('game');
      renderQuestion();
    }

    function finishGame(){
      const correctCount = STATE.records.filter(r=>r.isCorrect).length;
      els.score.textContent = String(correctCount);
      els.tbody.innerHTML='';
      const frag = document.createDocumentFragment();
      STATE.records.forEach(r=>{
        const tr=document.createElement('tr');
        const tdJudge=document.createElement('td');
        tdJudge.className='center';
        tdJudge.innerHTML = r.isCorrect ? '<span class="ok">â—‹</span>' : '<span class="ng">Ã—</span>';
        const tdImg=document.createElement('td');
        const im=document.createElement('img');
        im.className='thumb'; im.loading='lazy';
        im.src=`images/${encodeURIComponent(r.filename)}`; im.alt=r.correctAnswer;
        tdImg.appendChild(im);
        const tdAns=document.createElement('td'); tdAns.textContent=r.correctAnswer;
        const tdYou=document.createElement('td'); tdYou.textContent=r.userRaw??'';
        tr.append(tdJudge,tdImg,tdAns,tdYou); frag.appendChild(tr);
      });
      els.tbody.appendChild(frag);
      showScreen('result');
    }

    function submitAnswer(userRaw){
      const filename = STATE.questions[STATE.idx];
      const correct = extractAnswerFromFilename(filename);
      const ok = normalizeName(userRaw) === normalizeName(correct);
      STATE.records.push({ filename, correctAnswer: correct, userRaw, isCorrect: ok });
      if(ok){
        STATE.streak++;
        if(STATE.streak >= STATE.questions.length){ finishGame(); return; }
        STATE.idx++; renderQuestion();
      }else{ finishGame(); }
    }

    // Events
    els.playBtn.addEventListener('click', startGame);
    els.retryBtn.addEventListener('click', ()=>showScreen('start'));
    function giveUp(){
  const filename = STATE.questions[STATE.idx];
  const correct = extractAnswerFromFilename(filename);
  STATE.records.push({ filename, correctAnswer: correct, userRaw: 'ï¼ˆè«¦ã‚ï¼‰', isCorrect: false });
  finishGame();
}
els.giveUpBtn.addEventListener('click', giveUp);
els.form.addEventListener('submit',(ev)=>{ ev.preventDefault(); const v=els.input.value.trim(); if(!v) return; submitAnswer(v); });

    // Init: manifest ã‚’å¿…é ˆã«
    (async function init(){
      try{
        const res = await fetch('images/manifest.json',{cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const list = await res.json();
        if(!Array.isArray(list) || list.length===0) throw new Error('manifest ãŒç©ºã§ã™');
        // è¨±å®¹æ‹¡å¼µå­ã®ã¿ã«é™å®š & é †åºç¶­æŒã®é‡è¤‡æ’é™¤
        const extRe = /\.(png|jpg|jpeg|gif|webp)$/i;
        const seen=new Set();
        STATE.allImages = list.filter(x=>extRe.test(x) && !seen.has(x) && seen.add(x));
        els.poolInfo.textContent = `èª­ã¿è¾¼ã¿å®Œäº†ï¼š${STATE.allImages.length} æš`;
        els.playBtn.disabled = STATE.allImages.length === 0;
      }catch(err){
        els.error.style.display='block';
        els.error.textContent = `manifest ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${err.message}ï¼ˆimages/manifest.json ã‚’é…ç½®ã—ã¦ãã ã•ã„ï¼‰`;
        els.poolInfo.textContent = 'èª­ã¿è¾¼ã¿å¤±æ•—';
        els.playBtn.disabled = true;
      }
    })();
  
// === Answer list popup ===
function openAnswerList(evt){
  evt && evt.preventDefault();
  const w = window.open('', 'answers', 'width=560,height=720,menubar=no,location=no,status=no,toolbar=no,resizable=yes,scrollbars=yes');
  if(!w){ alert('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'); return; }
  const boot = `<!doctype html><html lang="ja"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æ­£ç­”ä¸€è¦§</title>
    <style>
      :root{ --bg:#0b1020; --fg:#e8eef8; --muted:#9fb0c8; --card:#151b2f; --border:#24314f; }
      *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
      header{position:sticky;top:0;background:linear-gradient(#121a32,#0b1020);padding:10px 14px;border-bottom:1px solid var(--border)}
      h1{font-size:16px;margin:0}
      main{padding:12px}
      .note{color:var(--muted);font-size:12px;margin:4px 0 12px}
      table{width:100%;border-collapse:collapse}
      thead th{position:sticky;top:0;background:#121a32;color:var(--muted);font-weight:600;text-align:left;border-bottom:1px solid var(--border);padding:8px}
      tbody td{padding:8px;border-bottom:1px solid var(--border)}
      tbody tr:hover{background:#101735}
      input[type=search]{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:#0e1530;color:var(--fg);outline:none}
    </style>
  </head><body>
    <header><h1>æ­£ç­”ä¸€è¦§</h1></header>
    <main>
      <input id="filter" type="search" placeholder="ç•ªå·ã¾ãŸã¯åå‰ã§çµã‚Šè¾¼ã¿â€¦" />
      <div class="note">ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¯ãƒˆãƒƒãƒ—ç”»é¢ã‹ã‚‰ã®ã¿é–‹ã‘ã¾ã™ã€‚ãƒ—ãƒ¬ã‚¤ä¸­ã¯é–‹ã‘ã¾ã›ã‚“ã€‚</div>
      <div id="status" class="note">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
      <div style="overflow:auto; max-height: calc(100vh - 170px)">
        <table id="tbl"><thead><tr></tr></thead><tbody></tbody></table>
      </div>
    </main>
  </body></html>`;
  w.document.open(); w.document.write(boot); w.document.close();

  const doc = w.document;
  const $ = sel => doc.querySelector(sel);

  function renderHeader(header){
    const tr = doc.querySelector('#tbl thead tr');
    tr.innerHTML = '';
    for(const h of header){
      const th = doc.createElement('th');
      th.textContent = h;
      tr.appendChild(th);
    }
  }
  function renderRows(rows){
    const tbody = $('#tbl tbody');
    tbody.innerHTML = '';
    const frag = doc.createDocumentFragment();
    for(const r of rows){
      const tr = doc.createElement('tr');
      for(const cell of r){
        const td = doc.createElement('td');
        td.textContent = cell ?? '';
        tr.appendChild(td);
      }
      frag.appendChild(tr);
    }
    tbody.appendChild(frag);
  }
  function parseCSV(text){
    return text.split(/\r?\n/).filter(line => line.trim() !== '').map(line => line.split(','));
  }
  function filterRows(allRows){
    const q = $('#filter').value.trim().toLowerCase();
    if(!q) return allRows;
    return allRows.filter(r => r.some(c => String(c||'').toLowerCase().includes(q)));
  }

  (async () => {
    try{
      let res = await fetch('correct.csv');
      if(!res.ok) res = await fetch('correct.txt');
      if(!res.ok) throw new Error('correct.csv / correct.txt ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      const txt = await res.text();
      const rows = parseCSV(txt);
      if(rows.length === 0) throw new Error('ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™');
      const header = rows[0];
      const data = rows.slice(1);
      renderHeader(header);
      renderRows(data);
      $('#status').textContent = `èª­ã¿è¾¼ã¿å®Œäº†ï¼š${data.length} ä»¶`;
      $('#filter').addEventListener('input', () => renderRows(filterRows(data)));
    }catch(err){
      $('#status').textContent = `èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${err.message}`;
    }
  })();
}

</script>
</body>
</html>
